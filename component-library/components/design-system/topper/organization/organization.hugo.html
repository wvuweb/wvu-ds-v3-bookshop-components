{{ $src := "" }}
{{ $imageSize := "" }}
{{ $backgroundColor := "bg-white text-dark" }}
{{ $headingColor := "text-wvu-blue" }}
{{ $pattern := "" }}
{{ $patternOpacity := "1" }}

{{ with .params.image_lg }}
  {{ $src = . }}
  {{ $imageSize = "960x640" }}
{{ end }}

{{ with .topper.background_image }}
  {{ $src = . }}
  {{ $imageSize = "1920x1280" }}
{{ end }}

{{ if .topper.settings.styles.color_palette }}
  {{ $backgroundColor = .topper.settings.styles.color_palette }}
{{ end }}

{{ if and .topper.background_image (not .topper.settings.styles.enable_blend) }}
  {{ $backgroundColor = "option-2" }}
{{ end }}

{{ if .topper.background_image }}
  {{ $backgroundColor = "bg-dark text-white" }}
{{ end }}

{{- if not site.Params.env_bookshop_live -}}
  {{ $image := "" }}
  {{/*  Get the image, either from its remote or local source  */}}
  {{ if hasPrefix $src "http"}}
    {{ $image = resources.GetRemote $src }}
  {{ else }}
    {{ $image = resources.Get $src }}
  {{ end }}

  {{/* Resize images and add them to a variable  */}}
  {{ if and $image (ne $image.MediaType.SubType "svg") }}
    {{ $src = ($image.Fill (printf "%s webp" $imageSize)).RelPermalink }}
  {{ end }}
{{- end -}}

<section class="audience-{{ .topper.settings.styles.audience }} tone-{{ .topper.settings.styles.tone}} bg-{{ $backgroundColor }} position-relative py-7">
  {{ if not .topper.background_image }}
    {{ partial "bookshop_partial" (slice "section_background_simple" (dict "image" "" "styles" .topper.settings.styles "layout" .topper.settings.layout)) }}
  {{ else }}
    {{ partial "bookshop_partial" (slice "section_background_simple" (dict "image" $src "styles" .topper.settings.styles "layout" .topper.settings.layout)) }}
  {{ end }}
  <div class="container mb-5 wvu-z-index-content">
    <div class="row gx-lg-0 align-items-center {{ if or .topper.background_image (not .params.image_lg) }}py-6{{ end }}">
      <div class="col-lg-12 {{ if .topper.background_image }}{{ .topper.settings.layout.text_placement }}{{ else }}mx-auto{{ end }}">
        <div class="row gx-4 gx-lg-5">
          <div class="col">
            {{ if .params.location }}
              <div class="mb-4">
                <p class="wvu-b-label"><span class="fa-regular fa-location-dot"></span> <span>{{ .params.location }}</span></p>
              </div>
            {{ end }}

            <h1 class="display-3 wvu-b-display-heading"><span class="wvu-b-font-adjust">{{ .params.name }}</span></h1>

            {{ with .params.contacts }}
              <h2 class="config-heavy h6 mt-5">Contact</h2>
              <p>
                {{ range . }}
                  <span class="d-block"><span class="d-inline-block me-3"><span class="fa-regular fa-user"></span> {{ .name }}</span> {{ with .phone }}<span class="d-inline-block me-3"><span class="fa-regular fa-phone"></span> <a href="tel:{{ . }}">{{ . }}</a></span>{{ end }} {{ with .email }}<span class="d-inline-block"><span class="fa-regular fa-envelope"></span> <a href="mailto:{{ . }}">{{ . }}</a></span>{{ end }}</span>
                {{ end }}
              </p>
            {{ end }}
            {{ with .params.social_media_accounts }}
              <h2 class="wvu-shout h6 mt-5">Follow</h2>
              <ul class="list-inline">
                {{ range . }}
                  <li class="list-inline-item"><a class="text-decoration-none" href="{{ .url }}"><span class="fa-brands fa-facebook"></span> {{ .platform }}</a></li>
                {{ end }}
              </ul>
            {{ end }}
          </div>
        </div>
      </div>
      {{ if and .params.image_lg (not .topper.background_image) }}
        <div class="col-lg-12">
          <img class="img-fluid wvu-shadow-filter border border-3 border-dark" src="{{ $src}}" alt="" />
        </div>
      {{ end }}
    </div>
  </div>
</section>